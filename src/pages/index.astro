---
import { getCollection } from 'astro:content';
import Base from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';

const events = await getCollection('events');
const upcoming = events
  .filter(e => new Date(e.data.date) >= new Date())
  .sort((a, b) => +new Date(a.data.date) - +new Date(b.data.date));

const next = upcoming[0];
const pageTitle = next ? `Mindfulina – ${next.data.title}` : 'Mindfulina – Next Event';
// Render the content if available
const { Content } = next ? await next.render() : { Content: null };
---

<Base title={pageTitle}>
  <div class="hidden md:block">
    <Hero />
  </div>
  
	{next ? (
			<article class="bg-white/60 backdrop-blur-md p-8 rounded-2xl shadow-lg">
				<h1 class="text-3xl font-bold mb-4">{next.data.title}</h1>
				<p><strong>When:</strong> {new Date(next.data.date).toLocaleString('en-US',{dateStyle:'full',timeStyle:'short'})}</p>
				<p><strong>Where:</strong> {next.data.location}</p>
				{next.data.cover && <img src={next.data.cover} alt={next.data.title + " cover image"} class="my-4 rounded-lg" />}
				<div class="prose mt-6">
					<Content />
				</div>
				<a href="/events" class="mt-8 inline-block">See all upcoming sessions →</a>
			</article>
		) : (
			<div class="bg-white/60 backdrop-blur-md p-8 rounded-2xl shadow-lg text-center">
        <h1 class="text-3xl font-bold mb-4">Sound Healing Sessions</h1>
        <div class="flex justify-center">
          <img src="/images/tall-shot.jpeg" alt="Mindfulina sound bath" class="rounded-lg shadow-md max-h-96 object-cover mb-6" />
        </div>
        <p class="mt-4 text-lg">Experience the soothing vibrations of crystal bowls in a beautiful oceanside setting.</p>
        <p class="mt-2">Upcoming events will be announced soon!</p>
      </div>
		)}
</Base>
